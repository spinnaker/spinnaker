<!--
  ~ Copyright 2014 Netflix, Inc.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~    http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<div class="btn-row col-md-12" ng-show="asg">
  <a href="#/{{deployable}}/clusters" class="btn btn-default" ng-show="cluster"><i class="fa fa-arrow-left"></i> Back to {{asg.cluster}}</a>
  <a href="#/" class="btn btn-default" ng-show="!cluster"><i class="fa fa-arrow-left"></i> Back to {{deployable}}</a>
  <a class="btn btn-warning" data-toggle="modal" data-target="#resizeModal"><i class="fa fa-expand"></i> Resize</a>
  <a class="btn btn-danger" data-toggle="modal" data-target="#deleteModal" ng-show="!asg.instances.length"><i class="fa fa-trash-o"></i> Delete</a>
</div>
<div ng-show="!asg">
  Loading...
</div>
<div class="container-fluid asg-detail-view" ng-show="asg">
  <ul class="asg-quick-info">
    <li>
      <span class="label label-primary">Deployable</span>
      <span><a href="#/{{deployable}}/clusters">{{deployable}}</a></span>
    </li>
    <li>
      <span class="label label-primary">Region</span>
      <span>{{region}}</span>
    </li>
    <li>
      <span class="label label-primary">Type</span>
      <span>{{asg.launchConfig.instanceType}}</span>
    </li>
    <li ng-show="asg.buildInfo">
      <span class="label label-primary">Build</span>
      <span>
        <a href="http://builds.netflix.com/job/{{asg.buildInfo.buildJobName}}/{{asg.buildInfo.buildJobNumber}}" target="_blank">
          {{asg.buildInfo.buildJobName}}/#{{asg.buildInfo.buildNumber}}
        </a>
      </span>
    </li>
    <li>
      <span class="label label-primary">Created</span>
      <span>{{toAgo(asg.created)}}</span>
    </li>
    <li>
      <span class="label label-primary">Capacity (min/max/desired)</span>
      <span>{{asg.capacity.min}} / {{asg.capacity.max}} / {{asg.capacity.desired}}</span>
    </li>
    <li>
      <span class="label label-primary">UDF</span>
      <span><button ng-click="showUserData()" class="btn btn-link">Show</button></span>
    </li>
  </ul>
  <table class="table table-condensed table-bordered">
    <thead>
      <tr>
        <th>Id</th>
        <th>Public DNS</th>
        <th>Public IP</th>
        <th>Private DNS</th>
        <th>Private IP</th>
        <th>Logs</th>
      </tr>
    </thead>
    <tbody>
      <tr ng-repeat="instance in asg.instances" class="{{instance.state.name == 'running' ? 'green' : 'red'}}">
        <td>{{instance.instanceId}}</td>
        <td>{{instance.publicDnsName}}</td>
        <td>{{instance.publicIpAddress}}</td>
        <td>{{instance.privateDnsName}}</td>
        <td>{{instance.privateIpAddress}}</td>
        <td>
          <a href="http://{{instance.publicDnsName}}:7001/AdminLogs/list?view=tomcat/catalina.out" target="_blank">catalina.out</a>
        </td>
      </tr>
    </tbody>
  </table>
</div>
<div id="resizeModal" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Resizing ASG: {{asg.name}}</h4>
      </div>
      <div class="modal-body">
        <form class="form-horizontal" role="form">
          <div class="form-group">
            <label for="min" class="col-sm-3 control-label">Min Size</label>
            <div class="col-sm-2">
              <input type="text" class="form-control" id="min" ng-model="resizeMin">
            </div>
          </div>
          <div class="form-group">
            <label for="max" class="col-sm-3 control-label">Max Size</label>
            <div class="col-sm-2">
              <input type="text" class="form-control" id="max" ng-model="resizeMax">
            </div>
          </div>
          <div class="form-group">
            <label for="desired" class="col-sm-3 control-label">Desired Size</label>
            <div class="col-sm-2">
              <input type="text" class="form-control" id="desired" ng-model="resizeDesired">
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" ng-click="resize(asg.name, asg.region)">Save changes</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<div id="deleteModal" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Deleting ASG: {{asg.name}}</h4>
      </div>
      <div class="modal-body">
        <p>Omg, are you sure?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-danger" ng-click="doAsgDelete(asg.name, asg.region)">Save changes</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->